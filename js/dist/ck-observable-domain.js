!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ckObservableDomain=t():e.ckObservableDomain=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";function n(e,t){const{prefix:r,substitor:n}=Object.assign({prefix:"~$£€"},t),o=r+">",i=r+"°",a=r+"þ",s=Symbol();let c=[];try{let t=0;function u(e){return e[s]=1,e}return JSON.stringify(e,function(e,r){if(e===o||e===i||e===a){if(null!==r&&r[s])return r;throw new Error("Conflicting serialization prefix: property '"+e+"' exists.")}if(null===r||"object"!=typeof r||r[s])return r;let l=r[i];if(l){if(l[s])return{[o]:l};throw new Error("Conflicting serialization prefix: property '"+i+"' exists.")}var f;if(r[i]=(f=t++,l=u(new Number(f))),c.push(r),r instanceof Array)r=u([u({[a]:u([l,"A"])}),...r]);else if(r instanceof Map)r=u([u({[a]:u([l,"M"])}),...[...r].map(e=>u(e))]);else if(r instanceof Set)r=u([u({[a]:u([l,"S"])}),...r]);else if(n){let e=n(r,a);e&&e!==r&&((r=e)[i]=l,r[a]=function(e){if("string"!=typeof e)throw new Error("Type must be a String.");return u(new String(e))}(r[a]||""))}return r})}finally{c.forEach(e=>delete e[i])}}function o(e,t){const{prefix:r,activator:n}=Object.assign({prefix:"~$£€"},t),o=r+">",i=r+"°",a=r+"þ";let s=null;const c=[];function u(e,t){let r=null;if(t instanceof Array){if(t.length>0&&null!=t[0]&&void 0!==(r=t[0][a])){switch(t.splice(0,1),r[1]){case"A":break;case"M":t=Object.assign(new Map,{v:t});break;case"S":t=Object.assign(new Set,{v:t});break;default:throw new Error("Expecting typed array to be 'A', 'M' or 'S'.")}c[r[0]]=t}}else if(null!==t){const e=t[i];void 0!==e&&(delete t[i],void 0!==(r=t[a])&&(delete t[a],n&&(t=n(t,r))&&(null===s&&(s=new Set),s.add(t))),c[e]=t)}return t}const l="string"==typeof e?JSON.parse(e,u):u(0,function e(t){if(t)if(t instanceof Array)for(let r=0;r<t.length;++r){const n=t[r];e(n),t[r]=u(0,n)}else if("object"==typeof t)for(const r in t){const n=t[r];e(n),t[r]=u(0,n)}return t}(e));function f(e,t){const r=t.length;for(let n=0;n<r;++n){const r=t[n];if(r){const i=r[o];void 0!==i&&(t[n]=e[i])}}}for(let e of c)if(null===s||!s.has(e))if(e instanceof Array)f(c,e);else if(e instanceof Map)e.v.forEach(e=>f(c,e)),e.v.forEach(t=>e.set(t[0],t[1])),delete e.v;else if(e instanceof Set)f(c,e.v),e.v.forEach(t=>e.add(t)),delete e.v;else for(const t in e){const r=e[t];if(null!==r){const n=r[o];void 0!==n&&(e[t]=c[n])}}return l}r.r(t),r.d(t,"serialize",function(){return n}),r.d(t,"deserialize",function(){return o})},function(e,t,r){"use strict";var n=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),i=function(){function e(e){var t=this,r="string"==typeof e?o.deserialize(e,{prefix:""}):e;this._props=r.P,this._tranNum=r.N;var n=function(e){for(var t=0,r=e.length,n=0;n<r;++n){var o=e[n];if(null!=o&&(++t,"object"==typeof o))for(var i in o){var a=o[i];if(a&&"object"==typeof a){var s=a.$C;void 0!==s&&(o[i]=e[a.$i])}}}return{count:t,graph:e}}(r.O);this._objCount=n.count,this._graph=n.graph,this._roots=r.R.map(function(e){return t._graph[e]})}return Object.defineProperty(e.prototype,"transactionNumber",{get:function(){return this._tranNum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allObjectsCount",{get:function(){return this._objCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allObjects",{get:function(){return function(e){var t,r,o;return n(this,function(n){switch(n.label){case 0:t=0,r=e,n.label=1;case 1:return t<r.length?null===(o=r[t])?[3,3]:[4,o]:[3,4];case 2:n.sent(),n.label=3;case 3:return t++,[3,1];case 4:return[2]}})}(this._graph)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roots",{get:function(){return this._roots},enumerable:!0,configurable:!0}),e.prototype.applyEvent=function(e){if(this._tranNum+1!==e.N)throw new Error("Invalid transaction number. Expected: "+(this._tranNum+1)+", got "+e.N+".");for(var t=e.E,r=0;r<t.length;++r){var n=t[r];switch(n[0]){case"N":var o=void 0;switch(n[2]){case"":o={};break;case"A":o=[];break;case"M":o=new Map;break;case"S":o=new Set;break;default:throw new Error("Unexpected Object type; "+n[2]+". Must be A, M, S or empty string.")}this._graph[n[1]]=o,this._objCount++;break;case"D":this._graph[n[1]]=null,this._objCount--;break;case"P":if(n[2]!=this._props.length)throw new Error("Invalid property creation event for '"+n[1]+"': index must be "+this._props.length+", got "+n[2]+".");this._props.push(n[1]);break;case"C":this._graph[n[1]][this._props[n[2]]]=this.getValue(n[3]);break;case"I":var i=this._graph[n[1]],a=n[2],s=this.getValue(n[3]);a===i.length?i[a]=s:i.splice(a,0,s);break;case"CL":var c=this._graph[n[1]];c instanceof Array?c.length=0:c.clear();break;case"R":this._graph[n[1]].splice(n[2],1);break;case"S":this._graph[n[1]].splice(n[2],1,this.getValue(n[3]));break;case"K":this._graph[n[1]].delete(this.getValue(n[2]));break;default:throw new Error("Unexpected Event code: '"+n[0]+"'.")}}this._tranNum=e.N},e.prototype.getValue=function(e){if(null!=e){var t=e[">"];if(void 0!==t)return this._graph[t]}return e},e}();t.ObservableDomain=i}])});
//# sourceMappingURL=ck-observable-domain.js.map