!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ckObservableDomain=t():e.ckObservableDomain=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";function n(e,t){const{prefix:r,substitor:n}=Object.assign({prefix:"~$£€"},t),i=r+">",o=r+"°",s=r+"þ",a=Symbol();let c=[];try{let t=0;function f(e){return e[a]=1,e}return JSON.stringify(e,function(e,r){if(e===i||e===o||e===s){if(null!==r&&r[a])return r;throw new Error("Conflicting serialization prefix: property '"+e+"' exists.")}if(null===r||"object"!=typeof r||r[a])return r;let l=r[o];if(l){if(l[a])return{[i]:l};throw new Error("Conflicting serialization prefix: property '"+o+"' exists.")}var u;if(r[o]=(u=t++,l=f(new Number(u))),c.push(r),r instanceof Array)r=f([f({[s]:f([l,"A"])}),...r]);else if(r instanceof Map)r=f([f({[s]:f([l,"M"])}),...[...r].map(e=>f(e))]);else if(r instanceof Set)r=f([f({[s]:f([l,"S"])}),...r]);else if(n){let e=n(r,s);e&&e!==r&&((r=e)[o]=l,r[s]=function(e){if("string"!=typeof e)throw new Error("Type must be a String.");return f(new String(e))}(r[s]||""))}return r})}finally{c.forEach(e=>delete e[o])}}function i(e,t){const{prefix:r,activator:n}=Object.assign({prefix:"~$£€"},t),i=r+">",o=r+"°",s=r+"þ";let a=null;const c=[];function f(e,t){let r=null;if(t instanceof Array){if(t.length>0&&null!=t[0]&&void 0!==(r=t[0][s])){switch(t.splice(0,1),r[1]){case"A":break;case"M":t=Object.assign(new Map,{v:t});break;case"S":t=Object.assign(new Set,{v:t});break;default:throw new Error("Expecting typed array to be 'A', 'M' or 'S'.")}c[r[0]]=t}}else if(null!==t){const e=t[o];void 0!==e&&(delete t[o],void 0!==(r=t[s])&&(delete t[s],n&&(t=n(t,r))&&(null===a&&(a=new Set),a.add(t))),c[e]=t)}return t}const l="string"==typeof e?JSON.parse(e,f):f(0,function e(t){if(t)if(t instanceof Array)for(let r=0;r<t.length;++r){const n=t[r];e(n),t[r]=f(0,n)}else if("object"==typeof t)for(const r in t){const n=t[r];e(n),t[r]=f(0,n)}return t}(e));function u(e,t){const r=t.length;for(let n=0;n<r;++n){const r=t[n];if(r){const o=r[i];void 0!==o&&(t[n]=e[o])}}}for(let e of c)if(null===a||!a.has(e))if(e instanceof Array)u(c,e);else if(e instanceof Map)e.v.forEach(e=>u(c,e)),e.v.forEach(t=>e.set(t[0],t[1])),delete e.v;else if(e instanceof Set)u(c,e.v),e.v.forEach(t=>e.add(t)),delete e.v;else for(const t in e){const r=e[t];if(null!==r){const n=r[i];void 0!==n&&(e[t]=c[n])}}return l}r.r(t),r.d(t,"serialize",function(){return n}),r.d(t,"deserialize",function(){return i})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);var i=function(){function e(e){var t=this;this.o="string"==typeof e?n.deserialize(e,{prefix:""}):e,this.props=this.o.P,this.tranNum=this.o.N,this.graph=function(e){for(var t=e.length,r=0;r<t;++r){var n=e[r];if(n&&"object"==typeof n)for(var i in n){var o=n[i];o&&"object"==typeof o&&void 0!==o.$C&&(n[i]=e[o.$i])}}return e}(this.o.O),this.roots=this.o.R.map(function(e){return t.graph[e]})}return e.prototype.applyEvent=function(e){if(this.tranNum+1>e.N)throw new Error("Invalid transaction number. Expected: greater than "+(this.tranNum+1)+", got "+e.N+".");for(var t=e.E,r=0;r<t.length;++r){var n=t[r];switch(n[0]){case"N":var i=void 0;switch(n[2]){case"":i={};break;case"A":i=[];break;case"M":i=new Map;break;case"S":i=new Set;break;default:throw new Error("Unexpected Object type; "+n[2]+". Must be A, M, S or empty string.")}this.graph[n[1]]=i;break;case"D":this.graph[n[1]]=null;break;case"P":if(n[2]!=this.props.length)throw new Error("Invalid property creation event for '"+n[1]+"': index must be "+this.props.length+", got "+n[2]+".");this.props.push(n[1]);break;case"C":this.graph[n[1]][this.props[n[2]]]=this.getValue(n[3]);break;case"I":var o=this.graph[n[1]],s=n[2],a=this.getValue(n[3]);s===o.length?o[s]=a:o.splice(s,0,a);break;case"CL":var c=this.graph[n[1]];c instanceof Array?c.length=0:c.clear();break;case"R":this.graph[n[1]].splice(n[2],1);break;case"S":this.graph[n[1]].splice(n[2],1,this.getValue(n[3]));break;case"K":this.graph[n[1]].delete(this.getValue(n[2]));break;default:throw new Error("Unexpected Event code: '"+n[0]+"'.")}}this.tranNum=e.N},e.prototype.getValue=function(e){if(null!=e){var t=e[">"];if(void 0!==t)return this.graph[t]}return e},e}();t.ObservableDomain=i}])});
//# sourceMappingURL=ck-observable-domain.js.map