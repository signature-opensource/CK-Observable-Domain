!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ckObservableDomain=t():e.ckObservableDomain=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){var t=this,r="string"==typeof e?function(e,t){const{prefix:r,activator:n}=Object.assign({prefix:"~$£€"},t),o=r+">",a=r+"°",i=r+"þ";let c=null;const s=[];function f(e,t){let r=null;if(t instanceof Array){if(t.length>0&&null!=t[0]&&void 0!==(r=t[0][i])){switch(t.splice(0,1),r[1]){case"A":break;case"M":t=Object.assign(new Map,{v:t});break;case"S":t=Object.assign(new Set,{v:t});break;default:throw new Error("Expecting typed array to be 'A', 'M' or 'S'.")}s[r[0]]=t}}else if(null!==t){const e=t[a];void 0!==e&&(delete t[a],void 0!==(r=t[i])&&(delete t[i],n&&(t=n(t,r))&&(null===c&&(c=new Set),c.add(t))),s[e]=t)}return t}const u="string"==typeof e?JSON.parse(e,f):f(0,function e(t){if(t)if(t instanceof Array)for(let r=0;r<t.length;++r){const n=t[r];e(n),t[r]=f(0,n)}else if("object"==typeof t)for(const r in t){const n=t[r];e(n),t[r]=f(0,n)}return t}(e));function l(e,t){const r=t.length;for(let n=0;n<r;++n){const r=t[n];if(r){const a=r[o];void 0!==a&&(t[n]=e[a])}}}for(let e of s)if(null===c||!c.has(e))if(e instanceof Array)l(s,e);else if(e instanceof Map)e.v.forEach(e=>l(s,e)),e.v.forEach(t=>e.set(t[0],t[1])),delete e.v;else if(e instanceof Set)l(s,e.v),e.v.forEach(t=>e.add(t)),delete e.v;else for(const t in e){const r=e[t];if(null!==r){const n=r[o];void 0!==n&&(e[t]=s[n])}}return u}(e,{prefix:""}):e,o=r.P;this.tranNum=r.N,this.graph=function(e){for(var t=e.length,r=0;r<t;++r){var o=e[r];if(o&&"object"===n(o))for(var a in o){var i=o[a];if(i&&"object"===n(i)){var c=i.$C;void 0!==c&&(o[a]=e[i.$i])}}}return e}(r.O),this.roots=r.R.map(function(e){return t.graph[e]}),this.applyEvent=function(e){var t=this,r=function(e){if(null!=e){var r=e[">"];if(void 0!==r)return t.graph[r]}return e};if(this.tranNum+1>e.N)throw new Error("Invalid transaction number. Expected: greater than ".concat(this.tranNum+1,", got ").concat(e.N,"."));for(var n=e.E,a=0;a<n.length;++a){var i=n[a];switch(i[0]){case"N":var c=void 0;switch(i[2]){case"":c={};break;case"A":c=[];break;case"M":c=new Map;break;case"S":c=new Set;break;default:throw new Error("Unexpected Object type; ".concat(i[2],". Must be A, M, S or empty string."))}this.graph[i[1]]=c;break;case"D":this.graph[i[1]]=null;break;case"P":if(i[2]!=o.length)throw new Error("Invalid property creation event for '".concat(i[1],"': index must be ").concat(o.length,", got ").concat(i[2],"."));o.push(i[1]);break;case"C":this.graph[i[1]][o[i[2]]]=r(i[3]);break;case"I":var s=this.graph[i[1]],f=i[2],u=r(i[3]);f===s.length?s[f]=u:s.splice(f,0,u);break;case"CL":var l=this.graph[i[1]];l instanceof Array?l.length=0:l.clear();break;case"R":this.graph[i[1]].splice(i[2],1);break;case"S":this.graph[i[1]].splice(i[2],1,r(i[3]));break;case"K":this.graph[i[1]].delete(r(i[2]));break;default:throw new Error("Unexpected Event code: '".concat(i[0],"'."))}}this.tranNum=e.N}}r.r(t),r.d(t,"ObservableDomain",function(){return o})}])});