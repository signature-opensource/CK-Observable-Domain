!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ckObservableDomain=t():e.ckObservableDomain=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){var t=this,r="string"==typeof e?function(e,t){const{prefix:r,activator:n}=Object.assign({prefix:"~$£€"},t),o=r+">",a=r+"°",c=r+"þ";let i=null;const s=[];function f(e,t){let r=null;if(t instanceof Array){if(t.length>0&&null!=t[0]&&void 0!==(r=t[0][c])){switch(t.splice(0,1),r[1]){case"A":break;case"M":t=Object.assign(new Map,{v:t});break;case"S":t=Object.assign(new Set,{v:t});break;default:throw new Error("Expecting typed array to be 'A', 'M' or 'S'.")}s[r[0]]=t}}else if(null!==t){const e=t[a];void 0!==e&&(delete t[a],void 0!==(r=t[c])&&(delete t[c],n&&(t=n(t,r))&&(null===i&&(i=new Set),i.add(t))),s[e]=t)}return t}const l="string"==typeof e?JSON.parse(e,f):f(0,function e(t){if(t)if(t instanceof Array)for(let r=0;r<t.length;++r){const n=t[r];e(n),t[r]=f(0,n)}else if("object"==typeof t)for(const r in t){const n=t[r];e(n),t[r]=f(0,n)}return t}(e));function u(e,t){const r=t.length;for(let n=0;n<r;++n){const r=t[n];if(r){const a=r[o];void 0!==a&&(t[n]=e[a])}}}for(let e of s)if(null===i||!i.has(e))if(e instanceof Array)u(s,e);else if(e instanceof Map)e.v.forEach(e=>u(s,e)),e.v.forEach(t=>e.set(t[0],t[1])),delete e.v;else if(e instanceof Set)u(s,e.v),e.v.forEach(t=>e.add(t)),delete e.v;else for(const t in e){const r=e[t];if(null!==r){const n=r[o];void 0!==n&&(e[t]=s[n])}}return l}(e,{prefix:""}):e,o=r.P;this.tranNum=r.N,this.graph=function(e){for(var t=e.length,r=0;r<t;++r){var o=e[r];if(o&&"object"===n(o))for(var a in o){var c=o[a];if(c&&"object"===n(c)){var i=c.$C;void 0!==i&&(o[a]=e[c.$i])}}}return e}(r.O),this.roots=r.R.map(function(e){return t.graph[e]}),this.applyEvent=function(e){var t=this,r=function(e){if(null!=e){var r=e[">"];if(void 0!==r)return t.graph[r]}return e};if(this.tranNum+1>e.N)throw new Error("Invalid transaction number. Expected: greater than ".concat(this.tranNum+1,", got ").concat(e.N,"."));for(var n=e.E,a=0;a<n.length;++a){var c=n[a];switch(c[0]){case"N":var i=void 0;switch(c[2]){case"":i={};break;case"A":i=[];break;case"M":i=new Map;break;case"S":i=new Set;break;default:throw new Error("Unexpected Object type; ".concat(c[2],". Must be A, M, S or empty string."))}this.graph[c[1]]=i;break;case"D":this.graph[c[1]]=null;break;case"P":if(c[2]!=o.length)throw new Error("Invalid property creation event for '".concat(c[1],"': index must be ").concat(o.length,", got ").concat(c[2],"."));o.push(c[1]);break;case"C":this.graph[c[1]][o[c[2]]]=r(c[3]);break;case"I":var s=this.graph[c[1]],f=c[2],l=r(c[3]);f===s.length?s[f]=l:s.splice(f,0,l);break;case"CL":var u=this.graph[c[1]];u instanceof Array?u.length=0:u.clear();break;case"R":this.graph[c[1]].splice(c[2],1);break;case"S":this.graph[c[1]].splice(c[2],1,r(c[3]));break;case"K":this.graph[c[1]].delete(r(c[2]));break;default:throw new Error("Unexpected Event code: '".concat(c[0],"'."))}}this.tranNum=e.N}}r.r(t),r.d(t,"ObservableDomain",function(){return o})}])});